<!DOCTYPE html>
<html>
<head>
    <title>Artist Portfolio</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
    <h1>My Art</h1>
    <nav>
        <a href="/">Home</a>
        <span id="auth-links"></span>
    </nav>
</header>

<section id="gallery" class="gallery"></section>

<section id="upload-section" style="display:none;">
    <h2>Upload Image</h2>
    <form action="/upload" method="post" enctype="multipart/form-data">
        <input type="file" name="image" required>
        <button type="submit">Upload</button>
    </form>
</section>

<section id="blog">
    <h2>Blog</h2>
    <div id="posts"></div>
    <div id="new-post" style="display:none;">
        <form action="/post" method="post">
            <textarea name="content" rows="4" cols="50" required></textarea><br>
            <button type="submit">Post</button>
        </form>
    </div>
</section>

<script>
function loadGallery() {
    fetch('/gallery')
        .then(res => res.json())
        .then(data => {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';
            data.images.forEach(src => {
                const img = document.createElement('img');
                img.src = src;
                gallery.appendChild(img);
            });
        });
}
function loadPosts() {
    fetch('/posts')
        .then(res => res.json())
        .then(data => {
            const postsDiv = document.getElementById('posts');
            postsDiv.innerHTML = '';
            data.posts.forEach(p => {
                const div = document.createElement('div');
                div.className = 'post';
                div.innerHTML = `<small>${new Date(p.date).toLocaleString()}</small><p>${p.content}</p>`;
                postsDiv.appendChild(div);
            });
        });
}
function checkAuth() {
    fetch('/auth')
        .then(res => res.json())
        .then(data => {
            if (data.loggedIn) {
                document.getElementById('auth-links').innerHTML = '<a href="/logout">Logout</a>';
                document.getElementById('upload-section').style.display = 'block';
                document.getElementById('new-post').style.display = 'block';
            } else {
                document.getElementById('auth-links').innerHTML = '<a href="/login.html">Login</a>';
            }
        });
}
loadGallery();
loadPosts();
checkAuth();
</script>
</body>
</html>
